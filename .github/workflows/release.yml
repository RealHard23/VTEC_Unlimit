# ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏Å‡πÇ‡∏ü‡∏•‡∏ß‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô GitHub Actions UI
name: Build & Release Magisk Module

# ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏ó‡∏£‡∏¥‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏Å‡πÇ‡∏ü‡∏•‡∏ß‡πå
on:
  # ‡∏ó‡∏£‡∏¥‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£ push ‡πÑ‡∏õ‡∏¢‡∏±‡∏á branch 'main'
  push:
    branches:
      - main
  # ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ô‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏Å‡πÇ‡∏ü‡∏•‡∏ß‡πå‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á‡∏à‡∏≤‡∏Å GitHub UI
  workflow_dispatch:

# ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏Å‡πÇ‡∏ü‡∏•‡∏ß‡πå
permissions:
  contents: write # ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á release ‡πÅ‡∏•‡∏∞ commit ‡πÑ‡∏ü‡∏•‡πå update.json ‡πÑ‡∏î‡πâ

# ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πà‡∏ß‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏Å‡πÇ‡∏ü‡∏•‡∏ß‡πå
env:
  MODULE_VERSION: v4.2.1
  VERSION_CODE: 45
  ZIP_NAME: VTEC_Unlimit_4.2.1.zip

# ‡∏Å‡∏≥‡∏´‡∏ô‡∏î Jobs ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏£‡∏±‡∏ô
jobs:
  build:
    # ‡∏£‡∏±‡∏ô Job ‡∏ö‡∏ô Ubuntu ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    runs-on: ubuntu-latest

    # ‡∏Å‡∏≥‡∏´‡∏ô‡∏î Steps ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô Job 'build'
    steps:
      - name: Checkout repository # ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏î‡∏∂‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡∏à‡∏≤‡∏Å repository
        uses: actions/checkout@v4

      - name: Zip Magisk module # ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡πÑ‡∏ü‡∏•‡πå Magisk Module ‡πÄ‡∏õ‡πá‡∏ô ZIP
        run: |
          # ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á zip ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå ZIP ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
          # -r ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö recursive (‡∏£‡∏ß‡∏° directory ‡∏¢‡πà‡∏≠‡∏¢)
          # -x ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö exclude (‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏°‡πÑ‡∏ü‡∏•‡πå/‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)
          zip -r "$ZIP_NAME" \
            module.prop \
            install.sh \
            uninstall.sh \
            system/ \
            common/ \
            script/ \
            META-INF/ \
            -x "*.git*" "*.github*" "README.md" "LICENSE.md" "changelog.md" "update.json"
          echo "‚úÖ ZIP created: $ZIP_NAME"

      - name: Update update.json # ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏ü‡∏•‡πå update.json
        run: |
          # ‡πÉ‡∏ä‡πâ heredoc (cat << EOF) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ JSON
          # ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ ${{ github.repository }} ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠ repository
          cat << EOF > update.json
          {
            "version": "${{ env.MODULE_VERSION }}",
            "versionCode": "${{ env.VERSION_CODE }}",
            "zipUrl": "https://github.com/${{ github.repository }}/releases/download/${{ env.MODULE_VERSION }}/${{ env.ZIP_NAME }}",
            "changelog": "https://raw.githubusercontent.com/${{ github.repository }}/main/changelog.md"
          }
          EOF
          echo "‚úÖ update.json created."

      - name: Commit updated update.json # ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 4: Commit ‡πÑ‡∏ü‡∏•‡πå update.json ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á/‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï
        run: |
          # ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ Git ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ commit
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          # ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏ü‡∏•‡πå update.json ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà staging area
          git add update.json
          # ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà ‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞ commit ‡πÅ‡∏•‡∏∞ push
          git diff-index --quiet HEAD || (
            git commit -m "Update update.json for ${{ env.MODULE_VERSION }} [skip ci]"
            git push
          )
        env:
          # ‡πÉ‡∏ä‡πâ GITHUB_TOKEN ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ GitHub Actions ‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ push
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Create GitHub Release # ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 5: ‡∏™‡∏£‡πâ‡∏≤‡∏á GitHub Release
        # ‡πÉ‡∏ä‡πâ Action ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏π‡∏õ 'softprops/action-gh-release@v2'
        uses: softprops/action-gh-release@v2
        # ‡∏™‡πà‡∏ß‡∏ô 'with:' ‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏¢‡∏∑‡πâ‡∏≠‡∏á 4 ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å 'name:' ‡∏´‡∏£‡∏∑‡∏≠ 2 ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å 'uses:'
        with:
          # ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏†‡∏≤‡∏¢‡πÉ‡∏ï‡πâ 'with:' ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏¢‡∏∑‡πâ‡∏≠‡∏á 2 ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å 'with:'
          tag_name: ${{ env.MODULE_VERSION }}
          name: Release ${{ env.MODULE_VERSION }}
          # 'body:' ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏¢‡∏∑‡πâ‡∏≠‡∏á 2 ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å 'with:'
          body: |
            # ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 'body:' ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏¢‡∏∑‡πâ‡∏≠‡∏á 2 ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å 'body:'
            üîì VTEC Unlock ${{ env.MODULE_VERSION }} - Version Code: ${{ env.VERSION_CODE }}
            üìÑ Changelog: https://raw.githubusercontent.com/${{ github.repository }}/main/changelog.md
          files: ${{ env.ZIP_NAME }}
        env:
          # 'env:' ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏¢‡∏∑‡πâ‡∏≠‡∏á 2 ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å 'name:' ‡∏´‡∏£‡∏∑‡∏≠ 2 ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å 'uses:'
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Done # ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢: ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô
        run: echo "‚úÖ Magisk Module Released: ${{ env.MODULE_VERSION }}"
        
