name: Sync GitHub Release to Repo

on:
  workflow_dispatch:
  schedule:
    - cron: '0 1 * * *'  # ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô‡∏ï‡∏≠‡∏ô‡∏ï‡∏µ 1 (UTC)

jobs:
  sync-release:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Download latest release asset (ZIP only)
        run: |
          echo "üîç Getting latest release URL..."
          asset_url=$(curl -s https://api.github.com/repos/${{ github.repository }}/releases/latest | \
            jq -r '.assets[] | select(.name | endswith(".zip")) | .browser_download_url')
          
          if [[ -z "$asset_url" ]]; then
            echo "‚ùå No .zip asset found in the latest release."; exit 1;
          fi

          echo "‚¨áÔ∏è Downloading from $asset_url"
          curl -L "$asset_url" -o latest.zip

      - name: Unzip & Sync Files
        run: |
          unzip -o latest.zip -d temp_sync
          rsync -av --delete temp_sync/ ./  # Sync ‡∏ó‡∏∏‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏≤‡∏Å release ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ root repo

      - name: Commit Changes (if any)
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git add .
          if git diff --cached --quiet; then
            echo "‚úÖ No changes detected. Nothing to commit."
          else
            git commit -m "üîÑ Sync from latest GitHub Release"
            git push
          fi
